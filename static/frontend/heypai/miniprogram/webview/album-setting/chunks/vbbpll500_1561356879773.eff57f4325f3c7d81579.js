(window.webpackJsonp=window.webpackJsonp||[]).push([["heypai/miniprogram/webview/album-setting/chunks/vbbpll500_1561356879773"],{110:function(e,t,a){"use strict";a.r(t),a.d(t,"default",function(){return k});var n,o=a(0),r=a.n(o),i=a(10),c=a(13),l=a(3),s=a(14),u=a(21),m=a(24),d=a(5),b=a(16),f=a(9),g=a(18),p=a(19),v=a(8);function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function S(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}!function(e){e.add="1",e.edit="2"}(n||(n={}));var k=function(e){function t(e,a){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=S(this,N(t).call(this,e,a))).hasUploadImage=!1,o.uploadImg=function(){console.log("添加图片"),f.a.chooseImage().then(function(e){o.setState({avatarUrl:e.localData}),o.hasUploadImage=!0}).catch(function(e){console.log(e)})},o.changeMemberName=function(e){o.setState({memberName:e.target.value})},o.changeMemberRole=function(e){o.setState({memberRole:e.target.value})},o.deleteMember=function(){o.state.pageStatus!==n.add&&void 0!==o.id&&o.indexService.albumGuestDelete(o.id).then(function(e){"0000"===e.code&&window.history.back()}).catch(function(e){console.log(e)})},o.getPageData=function(){void 0!==o.id&&o.indexService.albumGuestQuery(o.albumMemberToken).then(function(e){if(console.log("mem",e),"0000"===e.code){var t=(e.data||{}).guestList.find(function(e){return o.id===e.id})||{};if(!Object.keys(t).length)return;o.setState({memberName:t.guestName,memberRole:t.guestRole,avatarUrl:t.avatarUrl})}}).catch(function(e){console.log(e)})},o.saveMember=function(){if(o.getSaveStatus()){var e=o.state;o.hasUploadImage?f.a.uploadImage({userId:o.albumMemberToken,notify:!0},[e.avatarUrl.split(",")[1]]).then(function(e){if(console.log("member ress",e),Object(g.a)(e))o.showMessage("图片上传失败 请稍后重试");else if(Object(p.a)(e))o.setMember(e[0].url);else{var t=e.find(function(e){return e.code!==v.a.success});t&&o.showMessage(t.msg)}}).catch(function(e){console.log(e)}):o.setMember()}},o.setMember=function(e){var t=e||o.state.avatarUrl,a=o.state,r=a.pageStatus,i=a.memberName,c=a.memberRole;r===n.add&&o.indexService.albumGuestAdd({avatarUrl:t,guestName:i,guestRole:c,guestType:u.a.person},o.albumMemberToken).then(function(e){"0000"===e.code&&f.a.goBack()}).catch(function(e){console.log(e)}),r===n.edit&&void 0!==o.id&&o.indexService.albumGuestUpdate(t,i,c,u.a.person,o.id).then(function(e){"0000"===e.code&&f.a.goBack()}).catch(function(e){console.log(e)})},o.getSaveStatus=function(){var e=o.state,t=e.memberName,a=e.memberRole,n=e.avatarUrl;return Boolean(t&&a&&n)},o.indexService=new m.a,window.addEventListener("resize",function(){o.setState({scrollHeight:o.getScrollHeight()})}),o.albumMemberToken=Object(d.b)(b.a.memberToken)||"",o.id=o.props.id,o.state={scrollHeight:o.getScrollHeight(),pageStatus:void 0!==o.id?n.edit:n.add,memberName:"",memberRole:"",avatarUrl:""},o}var a,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,i.a),a=t,(o=[{key:"componentDidMount",value:function(){this.getPageData()}},{key:"getScrollHeight",value:function(){var e=Number(s.a.px2DPIpx(90).slice(0,-2));return Object(l.getElemHeight)()-e}},{key:"render",value:function(){var e=this.state,t={backgroundImage:"url(".concat(e.avatarUrl,")")},a=this.classNames("default-add-btn","member-add-btn",e.avatarUrl?"":"no-bg");return r.a.createElement("div",{className:"default-add-index-block"},r.a.createElement(c.a,{height:this.state.scrollHeight},r.a.createElement("div",{onClick:this.uploadImg,className:a,style:t},!e.avatarUrl&&r.a.createElement("div",{className:"text"},"添加图片")),r.a.createElement("div",{className:"add-btn-tip"},"尺寸建议 180*180"),r.a.createElement("div",{className:"default-add-list"},r.a.createElement("div",{className:"default-add-item"},r.a.createElement("div",{className:"item-title"},"个人名称"),r.a.createElement("input",{onChange:this.changeMemberName,value:e.memberName,placeholder:"填写名字",className:"item-input",type:"text"})),r.a.createElement("div",{className:"default-add-item"},r.a.createElement("div",{className:"item-title"},"个人角色"),r.a.createElement("input",{onChange:this.changeMemberRole,value:e.memberRole,placeholder:"例如：嘉宾、主讲人、特别邀请等",className:"item-input",type:"text"}))),r.a.createElement("div",{className:"btns-block"},e.pageStatus===n.edit&&r.a.createElement("div",{onClick:this.deleteMember,className:"default-btn delete-btn"},"删除"),r.a.createElement("div",{onClick:this.saveMember,className:this.classNames("default-btn","save-btn","".concat(this.getSaveStatus()?"":"disable"))},"保存"))))}}])&&y(a.prototype,o),t}()}}]);