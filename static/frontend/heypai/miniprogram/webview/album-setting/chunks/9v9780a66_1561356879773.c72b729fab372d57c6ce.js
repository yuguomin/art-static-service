(window.webpackJsonp=window.webpackJsonp||[]).push([["heypai/miniprogram/webview/album-setting/chunks/9v9780a66_1561356879773"],{109:function(e,t,a){"use strict";a.r(t),a.d(t,"default",function(){return O});var n,o=a(0),i=a.n(o),r=a(10),c=a(13),l=a(3),s=a(14),u=a(21),d=a(24),g=a(9),m=a(16),f=a(5),v=a(18),h=a(19),p=a(8);function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function S(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}!function(e){e.add="1",e.edit="2"}(n||(n={}));var O=function(e){function t(e,a){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=S(this,N(t).call(this,e,a))).hasUploadImage=!1,o.uploadImg=function(){console.log("添加图片"),g.a.chooseImage().then(function(e){o.setState({avatarUrl:e.localData}),o.hasUploadImage=!0}).catch(function(e){console.log(e)})},o.changeOrganizationName=function(e){o.setState({organizationName:e.target.value})},o.changeOrganizationRole=function(e){o.setState({organizationRole:e.target.value})},o.deleteOrganization=function(){o.state.pageStatus!==n.add&&void 0!==o.id&&o.indexService.albumGuestDelete(o.id).then(function(e){"0000"===e.code&&window.history.back()}).catch(function(e){console.log(e)})},o.getPageData=function(){void 0!==o.id&&o.indexService.albumGuestQuery(o.albumMemberToken).then(function(e){if(console.log("ori",e),"0000"===e.code){var t=(e.data||{}).guestList.find(function(e){return o.id===e.id})||{};if(!Object.keys(t).length)return;o.setState({organizationName:t.guestName,organizationRole:t.guestRole,avatarUrl:t.avatarUrl})}}).catch(function(e){console.log(e)})},o.saveOrganization=function(){if(o.getSaveStatus()){var e=o.state;o.hasUploadImage?g.a.uploadImage({userId:o.albumMemberToken,notify:!0},[e.avatarUrl.split(",")[1]]).then(function(e){if(console.log("orig ress",e),Object(v.a)(e))o.showMessage("图片上传失败 请稍后重试");else if(Object(h.a)(e))o.setOrganization(e[0].url);else{var t=e.find(function(e){return e.code!==p.a.success});t&&o.showMessage(t.msg)}}).catch(function(e){console.log(e)}):o.setOrganization()}},o.setOrganization=function(e){var t=e||o.state.avatarUrl,a=o.state,i=a.pageStatus,r=a.organizationName,c=a.organizationRole;i===n.add&&o.indexService.albumGuestAdd({avatarUrl:t,guestName:r,guestRole:c,guestType:u.a.organization},o.albumMemberToken).then(function(e){"0000"===e.code&&g.a.goBack()}).catch(function(e){console.log(e)}),i===n.edit&&void 0!==o.id&&o.indexService.albumGuestUpdate(t,r,c,u.a.organization,o.id).then(function(e){"0000"===e.code&&g.a.goBack()}).catch(function(e){console.log(e)})},o.getSaveStatus=function(){var e=o.state,t=e.organizationName,a=e.organizationRole,n=e.avatarUrl;return Boolean(t&&a&&n)},o.indexService=new d.a,window.addEventListener("resize",function(){o.setState({scrollHeight:o.getScrollHeight()})}),o.albumMemberToken=Object(f.b)(m.a.memberToken)||"",o.id=o.props.id,o.state={scrollHeight:o.getScrollHeight(),pageStatus:void 0!==o.id?n.edit:n.add,organizationName:"",organizationRole:"",avatarUrl:""},o}var a,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(t,r.a),a=t,(o=[{key:"componentDidMount",value:function(){this.getPageData()}},{key:"getScrollHeight",value:function(){var e=Number(s.a.px2DPIpx(90).slice(0,-2));return Object(l.getElemHeight)()-e}},{key:"render",value:function(){var e=this.state,t={backgroundImage:"url(".concat(e.avatarUrl,")")},a=this.classNames("default-add-btn",e.avatarUrl?"":"no-bg");return i.a.createElement("div",{className:"default-add-index-block"},i.a.createElement(c.a,{height:this.state.scrollHeight},i.a.createElement("div",{onClick:this.uploadImg,className:a,style:t},!e.avatarUrl&&i.a.createElement("div",{className:"text"},"添加图片")),i.a.createElement("div",{className:"add-btn-tip"},"尺寸建议 320*180"),i.a.createElement("div",{className:"default-add-list"},i.a.createElement("div",{className:"default-add-item"},i.a.createElement("div",{className:"item-title"},"企业名称"),i.a.createElement("input",{onChange:this.changeOrganizationName,value:e.organizationName,placeholder:"例如：公司名、品牌名等",className:"item-input",type:"text"})),i.a.createElement("div",{className:"default-add-item"},i.a.createElement("div",{className:"item-title"},"企业角色"),i.a.createElement("input",{onChange:this.changeOrganizationRole,value:e.organizationRole,placeholder:"例如：主办方、承办方、赞助方等",className:"item-input",type:"text"}))),i.a.createElement("div",{className:"btns-block"},e.pageStatus===n.edit&&i.a.createElement("div",{onClick:this.deleteOrganization,className:"default-btn delete-btn"},"删除"),i.a.createElement("div",{onClick:this.saveOrganization,className:this.classNames("default-btn","save-btn","".concat(this.getSaveStatus()?"":"disable"))},"保存"))))}}])&&y(a.prototype,o),t}()}}]);